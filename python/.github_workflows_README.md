# GitHub Actions Workflows for Python Package

This directory contains automated workflows for the Python package.

## ğŸ“ Workflows

### 1. `python-release.yml` - Automated Release

**Trigger**: Push tags matching `py-v*` (e.g., `py-v0.1.0`)

**What it does**:
- Extracts version from tag
- Runs tests on all platforms
- Builds wheels for:
  - Linux (x86_64, aarch64)
  - macOS (x86_64, aarch64)
  - Windows (x64)
- Builds source distribution (sdist)
- Publishes to PyPI using Trusted Publishing
- Creates GitHub Release with artifacts

**Usage**:
```bash
# Create and push tag
git tag py-v0.1.0
git push origin py-v0.1.0

# GitHub Actions will automatically:
# 1. Build wheels for all platforms
# 2. Publish to PyPI
# 3. Create GitHub release
```

**Pre-release support**:
```bash
# Beta/RC releases publish to TestPyPI
git tag py-v0.1.0-beta.1
git push origin py-v0.1.0-beta.1
```

### 2. `python-ci.yml` - Continuous Integration

**Trigger**: 
- Push to `main` or `develop` branches
- Pull requests to `main`
- Changes to Python-related files

**What it does**:
- Tests on Linux, macOS, Windows
- Tests Python 3.8, 3.9, 3.10, 3.11, 3.12, 3.13, 3.14
- Runs type checking (mypy)
- Runs linting (ruff)
- Tests compatibility with `json_repair`
- Validates wheel builds
- Tests examples

**Matrix**:
```
OS: [ubuntu-latest, macos-latest, windows-latest]
Python: [3.8, 3.9, 3.10, 3.11, 3.12, 3.13, 3.14]
Total: 21 test combinations (3 OS Ã— 7 Python versions)
```

## ğŸ”§ Configuration

### Required Secrets

**For PyPI Trusted Publishing** (recommended):
- No secrets needed!
- Configure at: https://pypi.org/manage/account/publishing/

**For manual publishing** (alternative):
- `PYPI_API_TOKEN`: PyPI API token
- Add in repository Settings â†’ Secrets â†’ Actions

### Required Permissions

The workflows need these permissions:

```yaml
permissions:
  id-token: write  # For PyPI Trusted Publishing
  contents: write  # For creating GitHub releases
```

These are already configured in the workflow files.

## ğŸ“Š Workflow Status

Check workflow status at:
- https://github.com/Latias94/jsonrepair/actions

### Release Workflow
[![Python Package Release](https://github.com/Latias94/jsonrepair/actions/workflows/python-release.yml/badge.svg)](https://github.com/Latias94/jsonrepair/actions/workflows/python-release.yml)

### CI Workflow
[![Python Package CI](https://github.com/Latias94/jsonrepair/actions/workflows/python-ci.yml/badge.svg)](https://github.com/Latias94/jsonrepair/actions/workflows/python-ci.yml)

## ğŸ› Troubleshooting

### Release workflow fails

1. **Check the logs**: Click on the failed workflow run
2. **Common issues**:
   - PyPI authentication: Verify Trusted Publishing setup
   - Build errors: Check Rust/PyO3 compatibility
   - Test failures: Fix tests before releasing

### CI workflow fails

1. **Check which job failed**:
   - Test job: Fix failing tests
   - Type check: Fix type annotations
   - Lint: Run `ruff check` locally
   - Build: Check maturin configuration

2. **Run locally**:
   ```bash
   cd python
   
   # Run tests
   pytest tests/ -v
   
   # Type check
   mypy python/jsonrepair/__init__.pyi --strict
   
   # Lint
   ruff check python/ tests/ examples/
   
   # Build
   maturin build --release
   ```

### Workflow doesn't trigger

1. **Check trigger conditions**:
   - Release: Tag must match `py-v*` pattern
   - CI: Changes must be in watched paths

2. **Verify permissions**:
   - Settings â†’ Actions â†’ General
   - Enable "Read and write permissions"

## ğŸ“š Related Documentation

- [PUBLISHING.md](../python/PUBLISHING.md) - Complete publishing guide
- [RELEASE_CHECKLIST.md](../python/RELEASE_CHECKLIST.md) - Quick release reference
- [PYTHON_RELEASE_SUMMARY.md](../PYTHON_RELEASE_SUMMARY.md) - System overview

## ğŸ”„ Workflow Diagram

### Release Workflow

```
Tag: py-v0.1.0
       â†“
   Triggered
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Get Version  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Run Tests   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Build Wheels (Parallel)    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Linux  â”‚ macOS  â”‚Windows â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Build Source Dist       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Publish to PyPI          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Create GitHub Release      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CI Workflow

```
Push/PR
   â†“
Triggered
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Test Matrix (21 jobs)    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Ubuntu â”‚ macOS  â”‚Windowsâ”‚â”‚
â”‚  â”‚  3.8   â”‚  3.8   â”‚  3.8  â”‚â”‚
â”‚  â”‚  3.9   â”‚  3.9   â”‚  3.9  â”‚â”‚
â”‚  â”‚  3.10  â”‚  3.10  â”‚  3.10 â”‚â”‚
â”‚  â”‚  3.11  â”‚  3.11  â”‚  3.11 â”‚â”‚
â”‚  â”‚  3.12  â”‚  3.12  â”‚  3.12 â”‚â”‚
â”‚  â”‚  3.13  â”‚  3.13  â”‚  3.13 â”‚â”‚
â”‚  â”‚  3.14  â”‚  3.14  â”‚  3.14 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Quality Checks         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚Type Checkâ”‚    Lint      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Build Verification       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Best Practices

1. **Always test locally before pushing tags**:
   ```bash
   cd python
   pytest tests/ -v
   maturin build --release
   ```

2. **Use pre-release tags for testing**:
   ```bash
   git tag py-v0.1.0-beta.1
   ```

3. **Monitor workflow runs**:
   - Check Actions tab after pushing tags
   - Review logs if anything fails

4. **Keep workflows updated**:
   - Update Python versions as needed
   - Update action versions regularly
   - Test workflow changes in PRs

## ğŸ“ Support

If you encounter issues with workflows:

1. Check the [troubleshooting section](#-troubleshooting)
2. Review workflow logs in GitHub Actions
3. Open an issue with:
   - Workflow run URL
   - Error messages
   - Steps to reproduce

